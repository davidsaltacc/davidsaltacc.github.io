<!DOCTYPE html>
<html>
<head>
	<title>Audio Visualizer</title>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}
		
		#container {
			position: absolute;
			top: 0;
			left: 0;
			background: #000;
			width: 100%;
			height: 100%;
		}
		
		#canvas {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
		}
	</style>
</head>
<body>
	<div id="container">
		<canvas id="canvas"></canvas>
		<audio id="audio"></audio>
		<script>
			
			navigator.mediaDevices.getUserMedia({ "audio": true }).then((microphone) => {
			
				var container = document.getElementById("container");
				var canvas = document.getElementById("canvas");
				canvas.width = window.innerWidth;
				canvas.height = window.innerHeight;
				
				var ctx = canvas.getContext("2d");
				
				var audioCtx = new (window.AudioContext || window.webkitAudioContext)();
				var audioSource = audioCtx.createMediaStreamSource(microphone);
				var analyser = audioCtx.createAnalyser();
				audioSource.connect(analyser);
				
				analyser.fftSize = 1024;
				var bufferLength = analyser.frequencyBinCount;
				var dataArray = new Uint8Array(bufferLength);
				var barWidth = canvas.width / bufferLength;
				
				var x;
				function frame() {
					x = 0;
					
					
					// ctx.clearRect(0, 0, canvas.width, canvas.height); // CLEAR
					
					ctx.fillStyle = "rgba(0, 0, 0, 0.2)"; // FADE, last number: 0 = dont fade, 1, fade immediatly
					ctx.fillRect(0, 0, canvas.width, canvas.height);
					
					analyser.getByteFrequencyData(dataArray);
					for (var i = 0; i < bufferLength; i++) {
						var barHeight = dataArray[i] * 3;
						var red = (i * barHeight) / 5;
						var green = i;
						var blue = barHeight / 2;
						ctx.fillStyle = `rgb(${red}, ${green}, ${blue})`;
						ctx.fillRect(x, canvas.height - barHeight, barWidth, barHeight);
						x += barWidth;
					}
					requestAnimationFrame(frame);
				}
			
				frame();
			});
		</script>
	</div>
</body>
</html>